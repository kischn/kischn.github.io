# 一个代码中分层的看法

事情起因就是团队成员对我评审他代码有了意见： “你怎么老是针对我，那些 Controller 里面写逻辑的你怎么不去管？”。  

所以也就聊聊为什么 “Controller 中写逻辑我不会管”。

> 以下均为个人见解，这里面的偏见和短视等还需要各位包容。欢迎讨论。  

## MVC 与 MVVM

从代码分层说起，`Javaer` 们对 `MVC` 肯定不陌生，而前端和安卓的开发就对 `MVVM` 比较熟悉，很长一段时间我就懒得去理解里面具体，就是知道这是分层。许多面试题也会提到这块，比如 `Java` 项目里面 `MVC` 中的 `M-V-C` 各代表什么？  

我个人理解的编程的本质就是把数据库里面的数据展示到前端页面上，或者反过来把前端写的东西保存到数据库里面……嗯，曾经很长一段时间因为这个观点而沮丧过，因为觉得这看起来一点也不 `cool`，甚至有些 `low`，没有前途和意义。`Java` 就是干着一个 `外卖员` 的角色，当 `数据的搬运工`。  

### 面条代码

曾经看过 `php` 入门的一些资料，讲的就是如何从 `MySQL` 中查询出数据并展示出来。[比如这个](https://www.w3school.com.cn/php/php_mysql_select.asp)
深刻得解释了什么叫 `面向过程` 编程与 `面条代码` 是什么。当然，这两个概念在我看来差不多是等效的，就是瀑布式的代码。  

```php
<?php
$con = mysql_connect("localhost","peter","abc123");
if (!$con)
{
    die('Could not connect: ' . mysql_error());
}
mysql_select_db("my_db", $con);
$result = mysql_query("SELECT * FROM Persons");
while($row = mysql_fetch_array($result))
{
    echo $row['FirstName'] . " " . $row['LastName'];
    echo "<br />";
}
mysql_close($con);
?>
```

这样的代码好处就是`话不多说，撸起袖子就是干`，坏处就是维护起来很麻烦，要改一个逻辑就需要自己到处扒相关的代码，然后去改。  

### MVC

上面的问题，在 `Java` 领域就很少人能见到，因为几乎所有的教程教的都是下面三步走：

1. 先用 `JDBC` 查询出来以后把数据封装到一个 `Java Bean` 里面，后面其它操作都是操作的这个 `Java Bean`（`面向对象之封装`、`MVC之M`）。  

2. 写一个 `Controller` 或 `Servlet` 类来专门对这一类 `Java Bean` 进行查询或更新等操作（`面向对象之封装`、`MVC之C`）。

3. 再写 N 个 `JSP` 页面来进行相关的展示，比如列表啊、新增啊、详情啊。(`MVC之V`)。

上面就是一个 `MVC` 的应用了，当年可是高光了一波。  
好像也没有讲 `service` 层啊、`dao` 层啊…… 因为在我看来，后面细分已经不重要了，`service` 和 `dao` 只是 `controller` 层的延伸，从 `MVC` 的大局来看，它就是统称 `MVC` 中的 `C`。  

这也是我为啥也对 `业务逻辑写在 Controller 里面` 并怎么在乎的原因，**从当前的情况来讲 80% 的功能业务逻辑全写在 `controller` 也没啥大不了的。遇到共用代码、跨模块调用啊、对事务有要求啊等等情况的时候可以抽出 `service` 单独封装一下**。

而且，如果有心，可以注意到当前的项目里面 `service` 层里面也没分 `interface` 和 `impl`，因为当前没必要，如果真的遇到复杂需求，比如需要对接很多家的支付等场景的时候才需要拿出来。

### MVVM

其实上面就已经讲完了想要说的，继续扩展一下 `MVVM` 吧，`Model-View-ViewModel`。。没有了 `controller` 层，来了一个 `vm` 层。。
这种 `基因突变` 肯定是有原因的~当前总结就是这玩意儿好像都是在交互上出现...这是不是就是突破点？  
对嘛，交互上页面的变化是非常多的，不同的页面展示都是有自己的参数需要控制，而这些参数不是数据的一部分。  
所以就出现了这么一个结构，每一个 `View` 都有一个自己对应的数据叫 `ViewModel`（还可以进行双向绑定，由底层提供，比如浏览器提供View的事件，用户就可以用函数监听来进行相关操作），而 `View` 中的状态与 `ViewModel` 中的参数是一一绑定的，顺便，这里面的参数变化的时候也可以进行一些操作去更新 `数据`。  
再就是，每一个 `View` 就新建一个 `ViewModel` 有点浪费，所以 `ViewModel` 可以把这些额外的参数汇总一下成为一个超集，表现上就是一个 `ViewModel` 可以控制多个 `View`， 但是这并不破坏这套结构。

## 总结

以上，就是简单聊了一下我们常用的分层，好像没啥高级的东西。  

只是想说明一下，网上或者经验上那些条条框框大家都可以去深挖一下为什么这样，或许会有额外的收获~
